<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Users from "./requests/Users.js";
import Calendar from "./requests/Calendar.js";
import Activity from "./requests/Activity.js";
import Accounts from "./requests/Accounts.js";
import TaskService from "./requests/TaskService.js";
import LearningTasks from "./requests/LearningTasks.js";

/** API Client for Compass Edu */
class CompassClient {
  /** 
   * @param {string} domain
   * @param {string} cookies
   * @param {AccountResponse} userInfo 
   * @param {number} userId 
   */
  constructor(domain, cookies, userInfo, userId) {
    this.cookies = cookies;
    this.domain = domain;
    this.userInfo = userInfo;
    this.userId = userId;

    this.Accounts = Accounts(this)
    this.Users = Users(this)
    this.TaskService = TaskService(this)
    this.Activity = Activity(this)
    this.Calendar = Calendar(this)
    this.LearningTasks = LearningTasks(this)
  }

  /**
   * @memberof CompassClient
   * @description Create new client and fetch user info
   * @param {string} domain - Schools Compass Domain Name
   * @param {string} cookies - Session cookies for Authentication
   * @returns {Promise&lt;CompassClient>} Returns Client instance
   */  
  static async init(domain, cookies) {
    /** @type {AccountResponse} */
    let res = await fetch(`https://${domain}/Services/Accounts.svc/GetAccount`,{
      "method": "POST",
      "headers": {
        "accept": "*/*",
        "content-type": "application/json",
        "cookie": cookies,
      },
    }).then(res => {
      if(!res.ok) throw new Error(res.statusText+" "+res.url.replace('https://'+domain,''))
      return res.json()
    }).then(x => x.d)
    return new CompassClient(domain, cookies, res, res.userId);
  }

  /**
   * @memberof CompassClient
   * @param {"Accounts"|"Calendar"|"Activity"|"FileAssets"|"TaskService"|"LearningTasks"|"User"} service - API service to use
   * @param {string} location - API location to use
   * @param {any} [data] - Data to send with request (optional).
   * @param {"POST"|"GET"} [method] - HTTP Method for request, default to POST
   * @returns {Promise&lt;any>} Promise resolves reponse JSON
   */
  async newRequest(service,location,data,method) {
    let url = `https://${this.domain}/Services/${service}.svc/${location}`
    const res = await fetch(url, {
      "method": method || "POST",
      "body": JSON.stringify(data),
      "headers": {
        "accept": "*/*",
        "content-type": "application/json",
        "cookie": this.cookies,
      },
    })
    if(!res.ok) throw new Error(res.statusText+" "+res.url.replace('https://'+this.domain,''))
    let json = await res.json()
    return json.d
  }

  /**
   * @memberof CompassClient
   * @param {string} id 
   * @param {string} nodeId 
   * @returns {Promise&lt;string>} Returns file as String
   */
  async downloadFile(id,nodeId) {
    let url = `https://${this.domain}/Services/FileAssets.svc/DownloadFile?id=${id}&amp;nodeId=${nodeId}`
    const res = await fetch(url, {
      "method": "GET",
      "headers": {
        "accept": "*/*",
        "content-type": "application/json",
        "cookie": this.cookies,
      },
    })
    if(!res.ok) throw new Error(res.statusText+" "+res.url.replace('https://'+this.domain,''))
    return res.text()
  }
}
export default CompassClient</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Accounts.html">Accounts</a></li><li><a href="module-Activity.html">Activity</a></li><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-LearningTasks.html">LearningTasks</a></li><li><a href="module-TaskService.html">TaskService</a></li><li><a href="module-Users.html">Users</a></li></ul><h3>Classes</h3><ul><li><a href="CompassClient.html">CompassClient</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Mar 10 2024 13:51:23 GMT+1100 (Australian Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
